<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>store</title>
    <meta name="theme-color" content="#0d0d0d">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/shop.css">
</head>

<body>
  <!-- ALL ABOUT LARGE SCREENS -->
    <%- include ('partials/big-screen') %>





<div class="hold">
    <!-- NAVBAR  -->
    <%- include ('partials/nav') %>


        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="brand-text">
                    <h1>Selection Plaza</h1>
                    <p>Product display hall</p>
                </div>
            </div>


            <div class="shop-levels">
                <!-- FREE SHOP -->
                <% 
                  const freeShopPayment = payments.find(p => p.store === "FREE" && new Date(p.validUntil) > new Date());
                  const freeShopExpired = payments.find(p => p.store === "FREE" && new Date(p.validUntil) <= new Date());
                  const canShowFreeShop = !freeShopPayment && !freeShopExpired;
                %>
                
                <% if (canShowFreeShop) { %>
                <div class="product-card level-free">
                    <div class="card-header">
                        <div class="store-level">Free Trial Shop</div>
                        <div class="level-number">FREE</div>
                        <img src="/images/shop 6.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦0</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦300</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">3</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦300</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">3 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦900</span></div>
                        </div>
                        <button class="activate-button" onclick="activateFreeShop()">Activate Free Shop</button>
                    </div>
                </div>
                <% } %>
                
                <% if (freeShopPayment) { %>
                <div class="product-card level-free">
                    <div class="card-header">
                        <div class="store-level">Free Trial Shop (Active)</div>
                        <div class="level-number">FREE</div>
                        <img src="/images/shop 6.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Status</div><div class="stat-value">Active</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦300</div></div>
                            <div class="stat"><div class="stat-label">Remaining</div><div class="stat-value"><span id="countdown-FREE"></span></div></div>
                        </div>
                        <div class="income-section">
                            <p style="text-align: center; color: #27ae60; font-weight: bold;">Free shop is running! Claim daily income from dashboard.</p>
                        </div>
                        <script>
                            (() => {
                                const end = new Date("<%= freeShopPayment.validUntil %>").getTime();
                                const el = document.getElementById("countdown-FREE");
                                const timer = setInterval(() => {
                                    const now = Date.now();
                                    const diff = end - now;
                                    if (diff <= 0) {
                                        clearInterval(timer);
                                        el.innerText = "Expired";
                                        return;
                                    }
                                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                    const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                    el.innerText = `${days}d ${hrs}h`;
                                }, 1000);
                            })();
                        </script>
                    </div>
                </div>
                <% } %>




               <!-- S1 -->
<% const s1Payment = payments.find(p => p.store === "S1" && new Date(p.validUntil) > new Date()); %>
<div class="product-card level-1">
    <div class="card-header">
        <div class="store-level">Investment Plan</div>
        <div class="level-number">S1</div>
        <img src="/images/shop 1.png" alt="shop" class="gem-icon">
    </div>
    <div class="card-content">
        <div class="stats-grid">
            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦15,000</div></div>
            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦600</div></div>
            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
        </div>
        <div class="income-section">
            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦600</span></div>
            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦72,000</span></div>
        </div>

        <% if (s1Payment) { %>
            <!-- Active shop: show countdown -->
            <button class="activate-button" disabled>
                <span id="countdown-S1"></span>
            </button>
            <script>
                (() => {
                    const end = new Date("<%= s1Payment.validUntil %>").getTime();
                    const el = document.getElementById("countdown-S1");
                    const timer = setInterval(() => {
                        const now = Date.now();
                        const diff = end - now;
                        if (diff <= 0) {
                            clearInterval(timer);
                            el.innerText = "Activate ₦15,000";
                            el.parentElement.disabled = false;
                            el.parentElement.onclick = () => goToPayment(15000, "S1");
                            return;
                        }
                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        el.innerText = `${days}d ${hrs}h remaining`;
                    }, 1000);
                })();
            </script>
        <% } else { %>
            <!-- Not active: show Activate button -->
            <button class="activate-button" onclick="goToPayment(15000, 'S1')">Activate ₦15,000</button>
        <% } %>
    </div>
</div>


                
                <!-- S2 -->
<% const s2Payment = payments.find(p => p.store === "S2" && new Date(p.validUntil) > new Date()); %>
<div class="product-card level-2">
    <div class="card-header">
        <div class="store-level">Investment Plan</div>
        <div class="level-number">S2</div>
        <img src="/images/shop 2.png" alt="shop" class="gem-icon">
    </div>
    <div class="card-content">
        <div class="stats-grid">
            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦25,000</div></div>
            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦900</div></div>
            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
        </div>
        <div class="income-section">
            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦900</span></div>
            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦108,000</span></div>
        </div>

        <% if (s2Payment) { %>
            <!-- Active shop: show countdown -->
            <button class="activate-button" disabled>
                <span id="countdown-S2"></span>
            </button>
            <script>
                (() => {
                    const end = new Date("<%= s2Payment.validUntil %>").getTime();
                    const el = document.getElementById("countdown-S2");
                    const timer = setInterval(() => {
                        const now = Date.now();
                        const diff = end - now;
                        if (diff <= 0) {
                            clearInterval(timer);
                            el.innerText = "Activate ₦25,000";
                            el.parentElement.disabled = false;
                            el.parentElement.onclick = () => goToPayment(25000, "S2");
                            return;
                        }
                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        el.innerText = `${days}d ${hrs}h remaining`;
                    }, 1000);
                })();
            </script>
        <% } else { %>
            <!-- Not active: show Activate button -->
            <button class="activate-button" onclick="goToPayment(25000, 'S2')">Activate ₦25,000</button>
        <% } %>
    </div>
</div>




                <!-- S3 -->
                <% const s3Payment = payments.find(p => p.store === "S3" && new Date(p.validUntil) > new Date()); %>
                <div class="product-card level-3">
                    <div class="card-header">
                        <div class="store-level">Investment Plan</div>
                        <div class="level-number">S3</div>
                        <img src="/images/shop 3.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦50,000</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦2,000</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦2,000</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦240,000</span></div>
                        </div>
                        <% if (s3Payment) { %>
                            <button class="activate-button" disabled>
                                <span id="countdown-S3"></span>
                            </button>
                            <script>
                                (() => {
                                    const end = new Date("<%= s3Payment.validUntil %>").getTime();
                                    const el = document.getElementById("countdown-S3");
                                    const timer = setInterval(() => {
                                        const now = Date.now();
                                        const diff = end - now;
                                        if (diff <= 0) {
                                            clearInterval(timer);
                                            el.innerText = "Activate ₦50,000";
                                            el.parentElement.disabled = false;
                                            el.parentElement.onclick = () => goToPayment(50000, "S3");
                                            return;
                                        }
                                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        el.innerText = `${days}d ${hrs}h remaining`;
                                    }, 1000);
                                })();
                            </script>
                        <% } else { %>
                            <button class="activate-button" onclick="goToPayment(50000, 'S3')">Activate ₦50,000</button>
                        <% } %>
                    </div>
                </div>



                <!-- S4 -->
                <% const s4Payment = payments.find(p => p.store === "S4" && new Date(p.validUntil) > new Date()); %>
                <div class="product-card level-4">
                    <div class="card-header">
                        <div class="store-level">Investment Plan</div>
                        <div class="level-number">S4</div>
                        <img src="/images/shop 4.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦100,000</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦4,000</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦4,000</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦480,000</span></div>
                        </div>
                        <% if (s4Payment) { %>
                            <button class="activate-button" disabled>
                                <span id="countdown-S4"></span>
                            </button>
                            <script>
                                (() => {
                                    const end = new Date("<%= s4Payment.validUntil %>").getTime();
                                    const el = document.getElementById("countdown-S4");
                                    const timer = setInterval(() => {
                                        const now = Date.now();
                                        const diff = end - now;
                                        if (diff <= 0) {
                                            clearInterval(timer);
                                            el.innerText = "Activate ₦100,000";
                                            el.parentElement.disabled = false;
                                            el.parentElement.onclick = () => goToPayment(100000, "S4");
                                            return;
                                        }
                                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        el.innerText = `${days}d ${hrs}h remaining`;
                                    }, 1000);
                                })();
                            </script>
                        <% } else { %>
                            <button class="activate-button" onclick="goToPayment(100000, 'S4')">Activate ₦100,000</button>
                        <% } %>
                    </div>
                </div>



                <!-- S5 -->
                <% const s5Payment = payments.find(p => p.store === "S5" && new Date(p.validUntil) > new Date()); %>
                <div class="product-card level-5">
                    <div class="card-header">
                        <div class="store-level">Investment Plan</div>
                        <div class="level-number">S5</div>
                        <img src="/images/shop 5.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦200,000</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦8,000</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦8,000</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦960,000</span></div>
                        </div>
                        <% if (s5Payment) { %>
                            <button class="activate-button" disabled>
                                <span id="countdown-S5"></span>
                            </button>
                            <script>
                                (() => {
                                    const end = new Date("<%= s5Payment.validUntil %>").getTime();
                                    const el = document.getElementById("countdown-S5");
                                    const timer = setInterval(() => {
                                        const now = Date.now();
                                        const diff = end - now;
                                        if (diff <= 0) {
                                            clearInterval(timer);
                                            el.innerText = "Activate ₦200,000";
                                            el.parentElement.disabled = false;
                                            el.parentElement.onclick = () => goToPayment(200000, "S5");
                                            return;
                                        }
                                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        el.innerText = `${days}d ${hrs}h remaining`;
                                    }, 1000);
                                })();
                            </script>
                        <% } else { %>
                            <button class="activate-button" onclick="goToPayment(200000, 'S5')">Activate ₦200,000</button>
                        <% } %>
                    </div>
                </div>



                <!-- S6 -->
                <% const s6Payment = payments.find(p => p.store === "S6" && new Date(p.validUntil) > new Date()); %>
                <div class="product-card level-6">
                    <div class="card-header">
                        <div class="store-level">Investment Plan</div>
                        <div class="level-number">S6</div>
                        <img src="/images/shop 6.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦500,000</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦20,000</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦20,000</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦2,400,000</span></div>
                        </div>
                        <% if (s6Payment) { %>
                            <button class="activate-button" disabled>
                                <span id="countdown-S6"></span>
                            </button>
                            <script>
                                (() => {
                                    const end = new Date("<%= s6Payment.validUntil %>").getTime();
                                    const el = document.getElementById("countdown-S6");
                                    const timer = setInterval(() => {
                                        const now = Date.now();
                                        const diff = end - now;
                                        if (diff <= 0) {
                                            clearInterval(timer);
                                            el.innerText = "Activate ₦500,000";
                                            el.parentElement.disabled = false;
                                            el.parentElement.onclick = () => goToPayment(500000, "S6");
                                            return;
                                        }
                                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        el.innerText = `${days}d ${hrs}h remaining`;
                                    }, 1000);
                                })();
                            </script>
                        <% } else { %>
                            <button class="activate-button" onclick="goToPayment(500000, 'S6')">Activate ₦500,000</button>
                        <% } %>
                    </div>
                </div>



                <!-- S7 -->
                <% const s7Payment = payments.find(p => p.store === "S7" && new Date(p.validUntil) > new Date()); %>
                <div class="product-card level-7">
                    <div class="card-header">
                        <div class="store-level">Investment Plan</div>
                        <div class="level-number">S7</div>
                        <img src="/images/shop 7.png" alt="shop" class="gem-icon">
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat"><div class="stat-label">Investment</div><div class="stat-value">₦1,000,000</div></div>
                            <div class="stat"><div class="stat-label">Daily Income</div><div class="stat-value">₦40,000</div></div>
                            <div class="stat"><div class="stat-label">Available days</div><div class="stat-value">120</div></div>
                        </div>
                        <div class="income-section">
                            <div class="income-item"><span class="income-label">Daily income</span><span class="income-value">₦40,000</span></div>
                            <div class="income-item"><span class="income-label">Validity period</span><span class="income-value">120 days</span></div>
                            <div class="income-item"><span class="income-label">Total income</span><span class="income-value">₦4,800,000</span></div>
                        </div>
                        <% if (s7Payment) { %>
                            <button class="activate-button" disabled>
                                <span id="countdown-S7"></span>
                            </button>
                            <script>
                                (() => {
                                    const end = new Date("<%= s7Payment.validUntil %>").getTime();
                                    const el = document.getElementById("countdown-S7");
                                    const timer = setInterval(() => {
                                        const now = Date.now();
                                        const diff = end - now;
                                        if (diff <= 0) {
                                            clearInterval(timer);
                                            el.innerText = "Activate ₦1,000,000";
                                            el.parentElement.disabled = false;
                                            el.parentElement.onclick = () => goToPayment(1000000, "S7");
                                            return;
                                        }
                                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                                        const hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        el.innerText = `${days}d ${hrs}h remaining`;
                                    }, 1000);
                                })();
                            </script>
                        <% } else { %>
                            <button class="activate-button" onclick="goToPayment(1000000, 'S7')">Activate ₦1,000,000</button>
                        <% } %>
                    </div>
                </div>



            </div>
        </div>

</div>


        
<div id="payment-data" data-already-active="<%= !!activePayment %>"></div>
<script>
    function goToPayment(amount, store) {
        window.location.href = `/payment?amount=${amount}&store=${store}`;
    }

    async function activateFreeShop() {
        try {
            const response = await fetch('/activate-free-shop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                Toastify({
                    text: "Free shop activated successfully!",
                    duration: 3000,
                    gravity: "top",
                    position: "center",
                    backgroundColor: "#27ae60",
                }).showToast();
                
                // Reload page to show countdown
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                Toastify({
                    text: `❌ ${result.message}`,
                    duration: 3000,
                    gravity: "top",
                    position: "center",
                    backgroundColor: "#e74c3c",
                }).showToast();
            }
        } catch (error) {
            console.error('Activation error:', error);
            Toastify({
                text: "❌ Something went wrong",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "#e74c3c",
            }).showToast();
        }
    }
</script>




<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
  // Read query string param (like ?status=active_exists)
  const params = new URLSearchParams(window.location.search);
  const status = params.get("status");

  if (status === "active_exists") {
    Toastify({
      text: "❌ You already have an active store. Wait until it expires.",
      duration: 3000,
      gravity: "top",
      position: "center",
      backgroundColor: "#e74c3c",
    }).showToast();
  }

  if (status === "success") {
    Toastify({
      text: "✅ Payment submitted successfully. Awaiting approval.",
      duration: 3000,
      gravity: "top",
      position: "center",
      backgroundColor: "#27ae60",
    }).showToast();
  }

  if (status === "error") {
    Toastify({
      text: "⚠️ Something went wrong. Try again.",
      duration: 3000,
      gravity: "top",
      position: "center",
      backgroundColor: "#f39c12",
    }).showToast();
  }
</script>


</body>

</html>